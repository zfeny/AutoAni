# Telegram Bot ä½¿ç”¨æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°

AutoAni Telegram Bot æä¾›ä¾¿æ·çš„ç•ªå‰§è®¢é˜…ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒï¼š

- ğŸ“º æŸ¥çœ‹è®¢é˜…ï¼ˆæ–°ç•ª/è€ç•ª/æŒ‰å­£èŠ‚ç­›é€‰ï¼‰
- ğŸ¬ æŸ¥çœ‹å‰§é›†è¯¦æƒ…å’Œä¸‹è½½è¿›åº¦
- â• æ·»åŠ æ–°è®¢é˜…
- ğŸ—‘ï¸ åˆ é™¤è®¢é˜…ï¼ˆå¯é€‰åˆ é™¤æ–‡ä»¶ï¼‰
- ğŸ”” ä¸‹è½½å®Œæˆé€šçŸ¥

## é…ç½®

### 1. åˆ›å»º Telegram Bot

1. åœ¨ Telegram æœç´¢ `@BotFather`
2. å‘é€ `/newbot` åˆ›å»º Bot
3. æŒ‰æç¤ºè®¾ç½® Bot åç§°å’Œç”¨æˆ·å
4. è·å– Bot Tokenï¼ˆæ ¼å¼ï¼š`123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11`ï¼‰

### 2. è·å–ç”¨æˆ· ID

1. åœ¨ Telegram æœç´¢ `@userinfobot`
2. å‘é€ä»»æ„æ¶ˆæ¯è·å–ä½ çš„ç”¨æˆ· IDï¼ˆçº¯æ•°å­—ï¼‰

### 3. é…ç½® Bot å‘½ä»¤

å‚è€ƒ [BOTFATHER_SETUP.md](BOTFATHER_SETUP.md) åœ¨ BotFather ä¸­è®¾ç½®å‘½ä»¤åˆ—è¡¨ï¼š

```
start - ğŸ¬ å¯åŠ¨ Bot
series - ğŸ“º æŸ¥çœ‹è®¢é˜…
add - â• æ·»åŠ è®¢é˜…
status - ğŸ“Š ç³»ç»ŸçŠ¶æ€
help - â“ å¸®åŠ©ä¿¡æ¯
```

### 4. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# Telegram Bot é…ç½®
TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
TELEGRAM_ALLOWED_USERS=123456789,987654321  # å¤šä¸ªç”¨æˆ·ç”¨é€—å·åˆ†éš”
```

## å¯åŠ¨ Bot

### æ–¹å¼ä¸€ï¼šå•ç‹¬è¿è¡Œ Bot

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# è¿è¡Œ Bot
python run_bot.py
```

### æ–¹å¼äºŒï¼šä¸è‡ªåŠ¨è°ƒåº¦ä¸€èµ·è¿è¡Œ

ç¼–è¾‘ `main.py`ï¼ŒåŒæ—¶å¯åŠ¨è°ƒåº¦å™¨å’Œ Botï¼ˆTODOï¼šå¾…å®ç°ï¼‰

## ä½¿ç”¨æŒ‡å—

### å¯ç”¨å‘½ä»¤

Bot æä¾›ä»¥ä¸‹å‘½ä»¤ï¼š

- `/start` - å¯åŠ¨ Botï¼Œæ˜¾ç¤ºä¸»èœå•
- `/series` - ç›´æ¥æŸ¥çœ‹è®¢é˜…åˆ—è¡¨
- `/add` - ç›´æ¥æ·»åŠ è®¢é˜…
- `/status` - ç›´æ¥æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
- `/help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

### å¯åŠ¨å’Œä¸»èœå•

1. åœ¨ Telegram æ‰¾åˆ°ä½ çš„ Bot
2. å‘é€ `/start` å¯åŠ¨
3. çœ‹åˆ°ä¸»èœå•ï¼š
   - ğŸ“º æŸ¥çœ‹è®¢é˜…
   - â• æ·»åŠ è®¢é˜…
   - ğŸ“Š ç³»ç»ŸçŠ¶æ€
   - âš™ï¸ è®¾ç½®

### æŸ¥çœ‹è®¢é˜…

#### 1. ç‚¹å‡»ã€ŒğŸ“º æŸ¥çœ‹è®¢é˜…ã€

é€‰æ‹©åˆ†ç±»ï¼š
- **ğŸ†• æ–°ç•ª**ï¼šæ˜¾ç¤ºå½“å‰å­£åº¦çš„ç•ªå‰§
- **ğŸ“š è€ç•ª**ï¼šæ˜¾ç¤ºå†å²å­£åº¦çš„ç•ªå‰§

#### 2. æŸ¥çœ‹æ–°ç•ª

ç›´æ¥æ˜¾ç¤ºå½“å‰å­£åº¦çš„æ‰€æœ‰ç•ªå‰§åˆ—è¡¨ï¼ŒåŒ…æ‹¬ï¼š
- ç•ªå‰§åç§°
- è¿›åº¦æ¡ (â–“â–“â–“â–‘â–‘â–‘)
- çŠ¶æ€ç»Ÿè®¡ (âœ…å·²ä¸‹è½½ â¬‡ï¸ä¸‹è½½ä¸­ â³å¾…ä¸‹è½½)

#### 3. æŸ¥çœ‹è€ç•ª

å…ˆé€‰æ‹©å­£èŠ‚ï¼š
```
2024å¹´ç§‹å­£ç•ªç»„
2024å¹´å¤å­£ç•ªç»„
2024å¹´æ˜¥å­£ç•ªç»„
...
```

é€‰æ‹©åæ˜¾ç¤ºè¯¥å­£åº¦çš„ç•ªå‰§åˆ—è¡¨ã€‚

#### 4. æŸ¥çœ‹å‰§é›†è¯¦æƒ…

ç‚¹å‡»ä»»ä¸€ç•ªå‰§ï¼ŒæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š
```
ğŸ¬ ç•ªå‰§åç§°
TMDB: 12345 | 2025å¹´å†¬å­£ç•ªç»„

ğŸ“Š è¿›åº¦: 7/12 é›† (58%)
â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘

EP01 âœ… å·²ä¸‹è½½
EP02 âœ… å·²ä¸‹è½½
EP03 â¬‡ï¸ ä¸‹è½½ä¸­
EP04 â³ å¾…ä¸‹è½½
...
```

æ“ä½œæŒ‰é’®ï¼š
- **ğŸ”„ åˆ·æ–°çŠ¶æ€**ï¼šé‡æ–°è·å–æœ€æ–°çŠ¶æ€
- **ğŸ—‘ï¸ åˆ é™¤è®¢é˜…**ï¼šåˆ é™¤è¯¥è®¢é˜…

### æ·»åŠ è®¢é˜…

#### 1. ç‚¹å‡»ã€Œâ• æ·»åŠ è®¢é˜…ã€

Bot æç¤ºï¼šè¯·å‘é€èœœæŸ‘ RSS URL

#### 2. è·å– RSS URL

1. è®¿é—® [èœœæŸ‘è®¡åˆ’](https://mikanani.me/)
2. æ‰¾åˆ°æƒ³è®¢é˜…çš„ç•ªå‰§
3. å¤åˆ¶ RSS è®¢é˜…é“¾æ¥
   - æ ¼å¼ï¼š`https://mikanani.me/RSS/Bangumi?bangumiId=3736&subgroupid=370`

#### 3. å‘é€ URL

å°† RSS URL å‘é€ç»™ Bot

#### 4. ç¡®è®¤ä¿¡æ¯

Bot è§£æåæ˜¾ç¤ºç•ªå‰§ä¿¡æ¯ï¼š
```
âœ… æ‰¾åˆ°ç•ªå‰§ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¬ ç•ªå‰§åç§°
ğŸ“… é¦–æ’­: 2025-01-10
ğŸ“º æ€»é›†æ•°: 12 é›†
ğŸ·ï¸ å­£èŠ‚: 2025å¹´å†¬å­£ç•ªç»„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ç¡®è®¤æ·»åŠ è®¢é˜…ï¼Ÿ
```

ç‚¹å‡»ã€Œâœ… ç¡®è®¤æ·»åŠ ã€å®Œæˆè®¢é˜…ã€‚

### åˆ é™¤è®¢é˜…

#### 1. åœ¨å‰§é›†è¯¦æƒ…é¡µç‚¹å‡»ã€ŒğŸ—‘ï¸ åˆ é™¤è®¢é˜…ã€

#### 2. ç¡®è®¤åˆ é™¤

Bot æ˜¾ç¤ºç¡®è®¤ä¿¡æ¯ï¼š
```
âš ï¸ ç¡®è®¤åˆ é™¤è®¢é˜…ï¼Ÿ

ç•ªå‰§: ç•ªå‰§åç§°
å‰§é›†è®°å½•: 12 æ¡
å·²ä¸‹è½½æ–‡ä»¶: 7 ä¸ª

æ˜¯å¦åŒæ—¶åˆ é™¤å·²ä¸‹è½½çš„æ–‡ä»¶ï¼Ÿ
```

é€‰æ‹©ï¼š
- **ğŸ—‘ï¸ åˆ é™¤è®¢é˜…+æ–‡ä»¶**ï¼šåˆ é™¤è®¢é˜…å¹¶åˆ é™¤ OpenList ä¸­çš„æ–‡ä»¶
- **ğŸ“ ä»…åˆ é™¤è®¢é˜…**ï¼šåªåˆ é™¤è®¢é˜…è®°å½•ï¼Œä¿ç•™å·²ä¸‹è½½çš„æ–‡ä»¶
- **âŒ å–æ¶ˆ**ï¼šå–æ¶ˆæ“ä½œ

### ç³»ç»ŸçŠ¶æ€

ç‚¹å‡»ã€ŒğŸ“Š ç³»ç»ŸçŠ¶æ€ã€æŸ¥çœ‹æ•´ä½“ç»Ÿè®¡ï¼š
```
ğŸ“Š ç³»ç»ŸçŠ¶æ€

è®¢é˜…æ•°: 10
æ€»å‰§é›†æ•°: 86

å‰§é›†çŠ¶æ€åˆ†å¸ƒ:
  â³ å¾…ä¸‹è½½: 12 é›†
  â¬‡ï¸ ä¸‹è½½ä¸­: 5 é›†
  âœ… å·²ä¸‹è½½: 65 é›†
  âš ï¸ ä¸åŒ¹é…: 4 é›†

OpenList æ–‡ä»¶æ•°: 70
```

### ä¸‹è½½å®Œæˆé€šçŸ¥

å½“æœ‰å‰§é›†ä¸‹è½½å®Œæˆæ—¶ï¼ŒBot ä¼šè‡ªåŠ¨æ¨é€é€šçŸ¥ï¼š

**å•é›†é€šçŸ¥**ï¼š
```
âœ… ä¸‹è½½å®Œæˆ

ğŸ¬ ç•ªå‰§åç§°
ğŸ“º EP05

å·²æ·»åŠ åˆ° OpenList
```

**æ‰¹é‡é€šçŸ¥**ï¼ˆå¤šä¸ªå‰§é›†åŒæ—¶å®Œæˆï¼‰ï¼š
```
âœ… ä¸‹è½½å®Œæˆ (3 é›†)

ğŸ¬ ç•ªå‰§A
   EP05, EP06

ğŸ¬ ç•ªå‰§B
   EP03
```

## çŠ¶æ€å›¾æ ‡è¯´æ˜

- âœ… `openlist_exists/completed` - å·²ä¸‹è½½
- â¬‡ï¸ `downloading` - ä¸‹è½½ä¸­
- â³ `pending` - å¾…ä¸‹è½½
- âš ï¸ `mismatched` - å­—å¹•ä¸åŒ¹é…

## æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**ï¼šåªæœ‰ `TELEGRAM_ALLOWED_USERS` ä¸­çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ Bot
2. **åˆ é™¤æ–‡ä»¶**ï¼šåˆ é™¤è®¢é˜…æ—¶è¯·è°¨æ…é€‰æ‹©æ˜¯å¦åˆ é™¤æ–‡ä»¶
3. **é€šçŸ¥è®¾ç½®**ï¼šé€šçŸ¥é»˜è®¤å‘é€ç»™æ‰€æœ‰å…è®¸çš„ç”¨æˆ·
4. **åˆ†é¡µæµè§ˆ**ï¼šè®¢é˜…åˆ—è¡¨æ¯é¡µæ˜¾ç¤º 5 ä¸ªï¼Œå¯ä»¥ç¿»é¡µæµè§ˆ

## æ•…éšœæ’æŸ¥

### Bot æ— å“åº”

1. æ£€æŸ¥ Bot æ˜¯å¦è¿è¡Œï¼š`ps aux | grep run_bot`
2. æ£€æŸ¥æ—¥å¿—è¾“å‡º
3. éªŒè¯ Token é…ç½®æ˜¯å¦æ­£ç¡®

### æ— æƒé™æç¤º

1. ç¡®è®¤ä½ çš„ç”¨æˆ· ID åœ¨ `TELEGRAM_ALLOWED_USERS` ä¸­
2. ç”¨æˆ· ID å¿…é¡»æ˜¯çº¯æ•°å­—
3. å¤šä¸ªç”¨æˆ·ç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼Œä¸è¦æœ‰ç©ºæ ¼

### æ·»åŠ è®¢é˜…å¤±è´¥

1. ç¡®è®¤ RSS URL æ ¼å¼æ­£ç¡®
2. æ£€æŸ¥ TMDB API é…ç½®
3. æŸ¥çœ‹ç»ˆç«¯æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### é€šçŸ¥æœªæ”¶åˆ°

1. ç¡®è®¤ `check_downloading_status` å‡½æ•°å¯ç”¨äº† `enable_notification=True`
2. æ£€æŸ¥ Bot Token é…ç½®
3. ç¡®è®¤ç”¨æˆ· ID é…ç½®æ­£ç¡®

## å¼€å‘æ‰©å±•

### æ·»åŠ æ–°å‘½ä»¤

åœ¨ `telegram_bot/handlers/` åˆ›å»ºæ–°çš„ handler æ–‡ä»¶ï¼š

```python
async def my_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # å¤„ç†é€»è¾‘
    pass
```

åœ¨ `telegram_bot/bot.py` æ³¨å†Œï¼š

```python
application.add_handler(CallbackQueryHandler(my_handler, pattern="^my_pattern$"))
```

### è‡ªå®šä¹‰é”®ç›˜

ç¼–è¾‘ `telegram_bot/keyboards.py`ï¼š

```python
@staticmethod
def my_keyboard() -> InlineKeyboardMarkup:
    keyboard = [
        [InlineKeyboardButton("æŒ‰é’®æ–‡æœ¬", callback_data="callback_data")]
    ]
    return InlineKeyboardMarkup(keyboard)
```

### ä¿®æ”¹é€šçŸ¥å†…å®¹

ç¼–è¾‘ `telegram_bot/notifier.py` ä¸­çš„é€šçŸ¥æ–‡æœ¬æ¨¡æ¿ã€‚

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-01-05)

- âœ… å®ç°æŸ¥çœ‹è®¢é˜…ï¼ˆæ–°ç•ª/è€ç•ª/å­£èŠ‚ç­›é€‰ï¼‰
- âœ… å®ç°å‰§é›†è¯¦æƒ…æ˜¾ç¤º
- âœ… å®ç°æ·»åŠ è®¢é˜…åŠŸèƒ½
- âœ… å®ç°åˆ é™¤è®¢é˜…åŠŸèƒ½ï¼ˆæ”¯æŒä¿ç•™æ–‡ä»¶é€‰é¡¹ï¼‰
- âœ… å®ç°ä¸‹è½½å®Œæˆæ¨é€é€šçŸ¥
- âœ… ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶
- âœ… åˆ†é¡µæµè§ˆæ”¯æŒ

## åé¦ˆå’Œå»ºè®®

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issueã€‚
